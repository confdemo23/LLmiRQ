CDH 5.2.0 has awkward functionality for path recreate failure
We do some tricks to find an available path in store writer when we roll filenamingstrategies order to find next available path. Basically we try to create a stream into a file to see if it&amp;apos;s available but we first do a check if path exists.
If we try to create a file which already exist, hdfs throws error "org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException)" and we move on. This is a way it works in apache hadoop but functionality in cdh is different.
CDH 5.2.0 on default sees this same error but internally waits 1min before re-trying and does this re-try 5 times. This is literally crazy because we on default try 10 times to find a suitable path which makes our tests to hang 50min for one single path. After a quick debugging there is a some sort of change in retry policies in cdh vs. vanilla hadoop.
File exist check and a try to open it is never an atomic operation so we need to handle a case where we try to open a file whose path already exist.
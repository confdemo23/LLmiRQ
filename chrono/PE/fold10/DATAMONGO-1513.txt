Non-ObjectId identifiers generated by event listeners are not populated if documents are inserted as batch
We have observed issues when persisting multiple entities at a time. The id does not get populated. It&amp;apos;s caused by insertDBObjectList() handling ids different compared to insertDBObject(). In our use case we define our own ids when persisting to Mongo. They are Strings. We use a MongoEventListener to set the id like this:






public void onBeforeSave(BaseEntity p, DBObject dbo) {




        if (p.isNew()) {




            String id = ....;




            dbo.put("_id", id);




        }




    }






This works fine when we persist only one instance at a time because the insertDBObject() does not care about the type of the id, but insertDBObjectList() does. It goes like this:






if (id instanceof ObjectId) {




    ids.add((ObjectId) id);




} else {




    // no id was generated




    ids.add(null);




}






Result is that we do no get the id populated in the entities we persist.
OSHs that remove capabilities cannot access the removed capability to restore runtime services during rollback
If an OSH removes a capability in Stage.MODEL, then removes services associated with the capability, and then the operation rolls back, the OSH can&amp;apos;t use the capability to figure out how to restore services.
This is a somewhat more difficult problem than what I addressed for actually removing the runtime services in [1]. That solution relied on making it easy for the remove step handler to use the capability it itself removed. But restoring services typically involves the remove handler calling out to utility code, often part of an add handler. Modifying that utility code to let the remove handler provide service names would be painful.
Instead I propose simply discarding the modified management model at the beginning of rollback, with the result that rollback handlers will see the capabilities as they existed before the op began.
See http://lists.jboss.org/pipermail/wildfly-dev/2015-July/004170.html for details.
[1]
A java.lang.Error in Stage.DONE can lead to hangs
As part of investigating https://bugzilla.redhat.com/show_bug.cgi?id=1259767 I&amp;apos;ve looked into general handling of situations when java.lang.Error is thrown during management operation execution.
Handling prior to Stage.DONE looks ok, with the error caught, logged and the failure-description on the response set. But if the error happens after commit or during rollback, it isn&amp;apos;t always properly triggering a response. In the intra-domain case the remote node that has the problem tries to send a failure response to the calling HC, but uses the wrong request id, resulting in that response being dropped and the calling HC continuing to wait.
A post-commit Error seems pretty unlikely. A rollback error seems more possible, as a rollback may involve installing significant numbers of services.
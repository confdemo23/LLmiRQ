Complex metadata dependency relationships behaving inconsistently between identical execution runs
Repeated execution of the following command will occasionally result in an exception:
rm -rf * .*; roo-dev script wedding.roo
An exception resulted on an intermittent basis. Research showed the WebScaffoldMetadata was reacting to an upstream dependency change and acquiring a particular instance of EntityMetadata. It would then iterate the dynamic finders declared by EntityMetadata and request a FinderMetadata instance. The FinderMetadata instance would be using a different instance of EntityMetadata (this was confirmed via System.identityHashCode(Object) calls). The problem is that EntityMetadata was not eagerly evicted from the cache. The intermittent nature of the problem was due to unordered Collection instances (specifically HashSet and HashMap) being used to store metadata dependency information, and the different ordering for notifications that subsequently resulted.
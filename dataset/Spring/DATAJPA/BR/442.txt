Repository initialization causes transaction rollback in CDI environments
The CreateIfNotFoundQueryLookupStrategy cannot be used with Hibernate 4.3 in a JTA environment. Spring Data JPA calls em.createNamedQuery(queryName) in the NamedQuery constructor to check if the named query exists. In previous Hibernate versions this caused an IllegalArgumentException to be thrown by the entity manager. But now Hibernate roles back the transaction and a NullPointerException is thrown that is never caught by Spring Data JPA.
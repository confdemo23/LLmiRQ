TestGet2.testGetClosestBefore fails with hadoop-0.17.1
TestGet2.testGetClosestBefore fails with hadoop-0.17.1
After the rows are flushed to a MapFile, we get no result when we try to find the closest row before 038. We find 035, but that is deleted. So we advance, the next record is 040 which is after 038 and we give up. This results in a null result being passed back to the test which then dies with an NPE because it expects that getClosestRowBefore should find row 030.
It appears that there is no logic to back up from a candidate row if the candidate came before the desired key but is deleted. We should find the row before.
I&amp;apos;m guessing that this is failing because hadoop-0.17.1 incorporates HADOOP-3472 (MapFile.Reader getClosest() function returns incorrect results when before is true)